<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.permission.mapper.SysUserMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.permission.pojo.SysUser">
        <id column="id" property="id" />
        <result column="username" property="username" />
        <result column="telephone" property="telephone" />
        <result column="email" property="email" />
        <result column="password" property="password" />
        <result column="dept_id" property="deptId" />
        <result column="status" property="status" />
        <result column="remark" property="remark" />
        <result column="operator" property="operator" />
        <result column="operator_time" property="operatorTime" />
        <result column="operator_ip" property="operatorIp" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, username, telephone, email, password, dept_id, status, remark, operator, operator_time, operator_ip
    </sql>

    <!-- 通用关联查询结果列 -->
    <sql id="Base_Join_Column_List">
        u.id, u.username, u.telephone, u.email, u.password, u.dept_id, u.status, u.remark, u.operator, u.operator_time, u.operator_ip
    </sql>

    <!-- 获取用户列表 -->
    <select id="selectUserList" resultType="com.permission.dto.SysUserDto">
        select
            <include refid="Base_Join_Column_List"/>
            , d.name as deptName
        from sys_user as u
        left join sys_dept as d on d.id = u.dept_id
        where u.status in (0, 1)
        <if test="sysUserQueryInput.search != null and sysUserQueryInput.search != ''">
            and (
                u.username like concat(#{sysUserQueryInput.search}, '%') or
                u.telephone like concat(#{sysUserQueryInput.search}, '%') or
                u.email like concat(#{sysUserQueryInput.search}, '%')
            )
        </if>
        <if test="sysUserQueryInput.deptIdList != null and sysUserQueryInput.deptIdList.size() > 0">
            and u.dept_id in
            <foreach collection="sysUserQueryInput.deptIdList" index="index" item="deptId" open="(" separator="," close=")">
                #{deptId}
            </foreach>
        </if>
    </select>

</mapper>
